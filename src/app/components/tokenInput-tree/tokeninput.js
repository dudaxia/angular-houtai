!function(t){function s(b){return String(null===b||void 0===b?"":b)}function r(b){return s(b).replace(l,function(c){return m[c]})}var q={method:"GET",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",propertyToDisplay:"name",jsonContainer:null,contentType:"json",excludeCurrent:!1,excludeCurrentParameter:"x",prePopulate:null,processPrePopulate:!1,hintText:"Type in a search term",noResultsText:"无搜索结果",searchingText:"Searching...",deleteText:"&#215;",animateDropdown:!0,placeholder:null,theme:null,zindex:9999,resultsLimit:null,enableHTML:!1,resultsFormatter:function(d){var c=d[this.propertyToDisplay];return"<li>"+(this.enableHTML?c:r(c))+"</li>"},tokenFormatter:function(d){var c=d[this.propertyToDisplay];return"<li><p class='group_item_name'>"+(this.enableHTML?c:r(c))+"</p></li>"},tokenLimit:null,tokenDelimiter:",",preventDuplicates:!1,tokenValue:"id",allowFreeTagging:!1,allowTabOut:!1,autoSelectFirstResult:!1,onResult:null,onCachedResult:null,onAdd:null,onFreeTaggingAdd:null,onDelete:null,onReady:null,idPrefix:"token-input-",disabled:!1},p={tokenList:"token-input-list input_text",token:"token-input-token group_item",tokenReadOnly:"token-input-token-readonly",tokenDelete:"token-input-delete-token  group_item_close",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token",focused:"token-input-focused",disabled:"token-input-disabled"},o={BEFORE:0,AFTER:1,END:2},n={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMPAD_ENTER:108,COMMA:188},m={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},l=/[&<>"'\/]/g,k={init:function(a,f){var d=t.extend({},q,f||{});return this.each(function(){t(this).data("settings",d),t(this).data("tokenInputObject",new t.TokenList(this,a,d))})},clear:function(){return this.data("tokenInputObject").clear(),this},add:function(b){return this.data("tokenInputObject").add(b),this},remove:function(b){return this.data("tokenInputObject").remove(b),this},get:function(){return this.data("tokenInputObject").getTokens()},toggleDisabled:function(b){return this.data("tokenInputObject").toggleDisabled(b),this},setOptions:function(a){return t(this).data("settings",t.extend({},t(this).data("settings"),a||{})),this},destroy:function(){if(this.data("tokenInputObject")){this.data("tokenInputObject").destroy();var d=this,c=this.parent();return c.empty(),d.show(),c.append(d),d}}};t.fn.tokenInput=function(b){return k[b]?k[b].apply(this,Array.prototype.slice.call(arguments,1)):k.init.apply(this,arguments)},t.TokenList=function(aV,aU,aT){function aS(b){return t(aV).data("settings").enableHTML?b:r(b)}function aR(b){t(aV).data("settings").disabled="boolean"==typeof b?b:!t(aV).data("settings").disabled,ae.attr("disabled",t(aV).data("settings").disabled),f.toggleClass(t(aV).data("settings").classes.disabled,t(aV).data("settings").disabled),ac&&aK(t(ac),o.END),ad.attr("disabled",t(aV).data("settings").disabled)}function aQ(){return null!==t(aV).data("settings").tokenLimit&&ag>=t(aV).data("settings").tokenLimit?(ae.hide(),void aG()):void 0}function aP(){if(ai!==(ai=ae.val())){var b=f.width()-ae.offset().left-f.offset().left;aW.html(r(ai)||r(aT.placeholder)),ae.width(Math.min(f.width(),Math.max(b,aW.width()+30)))}}function aO(){var h=t.trim(ae.val()),b=h.split(t(aV).data("settings").tokenDelimiter);t.each(b,function(u,j){if(j){t.isFunction(t(aV).data("settings").onFreeTaggingAdd)&&(j=t(aV).data("settings").onFreeTaggingAdd.call(ad,j));var i={};i[t(aV).data("settings").tokenValue]=i[t(aV).data("settings").propertyToDisplay]=j,aM(i)}})}function aN(j){var i=t(t(aV).data("settings").tokenFormatter(j)),h=j.readonly===!0?!0:!1;h&&i.addClass(t(aV).data("settings").classes.tokenReadOnly),i.addClass(t(aV).data("settings").classes.token).insertBefore(e),h||t("<span>").addClass(t(aV).data("settings").classes.tokenDelete+" js_close").appendTo(i).click(function(){if(!t(aV).data("settings").disabled){aI(t(this).parent());ad.change();if(ad.data("submit")){ad.closest("form").submit()}return false}});var b=j;return t.data(i.get(0),"tokeninput",j),ah=ah.slice(0,aa).concat([b]).concat(ah.slice(aa)),aa++,aH(ah,ad),ag+=1,null!==t(aV).data("settings").tokenLimit&&ag>=t(aV).data("settings").tokenLimit&&(ae.hide(),aG()),i}function aM(i){var h=t(aV).data("settings").onAdd;if(ag>0&&t(aV).data("settings").preventDuplicates){var b=null;if(f.children().each(function(){var j=t(this),u=t.data(j.get(0),"tokeninput");return u&&u[aT.tokenValue]===i[aT.tokenValue]?(b=j,!1):void 0}),b){return}}ae.width(1),(null==t(aV).data("settings").tokenLimit||ag<t(aV).data("settings").tokenLimit)&&(aN(i),ae.attr("placeholder",null),aQ()),ae.val(""),aG(),t.isFunction(h)&&h.call(ad,i)}function aL(b){t(aV).data("settings").disabled||(b.addClass(t(aV).data("settings").classes.selectedToken),ac=b.get(0),ae.val(""),aG())}function aK(h,b){h.removeClass(t(aV).data("settings").classes.selectedToken),ac=null,b===o.BEFORE?(e.insertBefore(h),aa--):b===o.AFTER?(e.insertAfter(h),aa++):(e.appendTo(f),aa=ag),al(ae)}function aJ(d){var h=ac;ac&&aK(t(ac),o.END),h===d.get(0)?aK(d,o.END):aL(d)}function aI(j){var i=t.data(j.get(0),"tokeninput"),h=t(aV).data("settings").onDelete,b=j.prevAll().length;b>aa&&b--,j.remove(),ac=null,al(ae),ah=ah.slice(0,b).concat(ah.slice(b+1)),0==ah.length&&(ae.attr("placeholder",aT.placeholder),ae.css("width","auto")),aa>b&&aa--,aH(ah,ad),ag-=1,null!==t(aV).data("settings").tokenLimit&&(ae.show().val(""),al(ae)),t.isFunction(h)&&h.call(ad,i)}function aH(i,h){var b=t.map(i,function(d){return"function"==typeof t(aV).data("settings").tokenValue?t(aV).data("settings").tokenValue.call(this,d):d[t(aV).data("settings").tokenValue]});h.val(b.join(t(aV).data("settings").tokenDelimiter))}function aG(){a.hide(),g=null}function aF(){a.css({position:"absolute",top:f.offset().top+f.outerHeight(!0)-1,left:f.offset().left,width:f.innerWidth(),"z-index":t(aV).data("settings").zindex}).show()}function aE(d){a.children("div").each(function(h,b){d.get(0)==b&&t(this).show()||t(this).hide()})}function aD(){t(aV).data("settings").hintText&&("string"===t.type(t(aV).data("settings").hintText)?az.html("<p>"+aS(t(aV).data("settings").hintText)+"</p>"):"function"===t.type(t(aV).data("settings").hintText)&&t(aV).data("settings").hintText(az),aE(az),aF())}function aC(){t(aV).data("settings").searchingText&&(aX.html("<p>"+aS(t(aV).data("settings").searchingText)+"</p>"),aE(aX))}function aB(){aE(aw)}function ax(b){return b.replace(ay,"\\$&")}function av(h,d){return h.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+ax(d)+")(?![^<>]*>)(?![^&;]+;)","gi"),function(j,i){return"<b>"+aS(i)+"</b>"})}function au(h,d,i){return h.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+ax(d)+")(?![^<>]*>)(?![^&;]+;)","g"),av(d,i))}function at(i){if(t(aV).data("settings").excludeCurrent){var h=t(aV).data("tokenInputObject").getTokens(),b=[];h.length&&(t.each(i,function(u,j){var d=!0;t.each(h,function(w,v){return j[t(aV).data("settings").propertyToDisplay]==v[t(aV).data("settings").propertyToDisplay]?(d=!1,!1):void 0}),d&&b.push(j)}),i=b)}return i}function ar(i,h){if(h=at(h),h&&h.length){aw.empty();var b=t("<ul/>").appendTo(aw).mouseover(function(d){aq(t(d.target).closest("li"))}).mousedown(function(d){aM(t(d.target).closest("li").data("tokeninput"));ad.change();if(ad.data("submit")){ad.closest("form").submit()}return false}).hide();t(aV).data("settings").resultsLimit&&h.length>t(aV).data("settings").resultsLimit&&(h=h.slice(0,t(aV).data("settings").resultsLimit)),t.each(h,function(v,u){var j=t(aV).data("settings").resultsFormatter(u);j=au(j,u[t(aV).data("settings").propertyToDisplay],i),j=t(j).appendTo(b),j.addClass(v%2?t(aV).data("settings").classes.dropdownItem:t(aV).data("settings").classes.dropdownItem2),0===v&&t(aV).data("settings").autoSelectFirstResult&&aq(j),t.data(j.get(0),"tokeninput",u)}),aB(),t(aV).data("settings").animateDropdown?b.slideDown("fast"):b.show()}else{t(aV).data("settings").noResultsText&&(aw.html("<p>"+aS(t(aV).data("settings").noResultsText)+"</p>"),aB())}}function aq(b){b&&(g&&ap(t(g)),b.addClass(t(aV).data("settings").classes.selectedDropdownItem),g=b.get(0))}function ap(b){b.removeClass(t(aV).data("settings").classes.selectedDropdownItem),g=null}function ao(){var b=ae.val();b&&b.length&&(ac&&aK(t(ac),o.AFTER),b.length>=t(aV).data("settings").minChars?(aC(),clearTimeout(aj),aj=setTimeout(function(){an(b)},t(aV).data("settings").searchDelay)):aG())}function an(B){var A=B+am(),z=af.get(A);if(z){t.isFunction(t(aV).data("settings").onCachedResult)&&(z=t(aV).data("settings").onCachedResult.call(ad,z)),ar(B,z)}else{if(t(aV).data("settings").url){var y=am(),x={};if(x.data={},y.indexOf("?")>-1){var w=y.split("?");x.url=w[0];var v=w[1].split("&");t.each(v,function(i,d){var j=d.split("=");x.data[j[0]]=j[1]})}else{x.url=y}if(x.data[t(aV).data("settings").queryParam]=B,x.type=t(aV).data("settings").method,x.dataType=t(aV).data("settings").contentType,t(aV).data("settings").crossDomain&&(x.dataType="jsonp"),t(aV).data("settings").excludeCurrent){var u=t(aV).data("tokenInputObject").getTokens(),h=t.map(u,function(d){return"function"==typeof t(aV).data("settings").tokenValue?t(aV).data("settings").tokenValue.call(this,d):d[t(aV).data("settings").tokenValue]});x.data[t(aV).data("settings").excludeCurrentParameter]=h.join(t(aV).data("settings").tokenDelimiter)}x.success=function(d){af.add(A,t(aV).data("settings").jsonContainer?d[t(aV).data("settings").jsonContainer]:d),t.isFunction(t(aV).data("settings").onResult)&&(d=t(aV).data("settings").onResult.call(ad,d)),ae.val()===B&&ar(B,t(aV).data("settings").jsonContainer?d[t(aV).data("settings").jsonContainer]:d)},aT.onSend&&aT.onSend(x),t.ajax(x)}else{if(t(aV).data("settings").local_data){var b=t.grep(t(aV).data("settings").local_data,function(C){var j=C[t(aV).data("settings").propertyToSearch];if(t.isArray(j)){var i=!1;return t.each(j,function(D,d){return d.toLowerCase().indexOf(B.toLowerCase())>-1?(i=!0,!1):void 0}),i}return j.toLowerCase().indexOf(B.toLowerCase())>-1});af.add(A,b),t.isFunction(t(aV).data("settings").onResult)&&(b=t(aV).data("settings").onResult.call(ad,b)),ar(B,b)}}}}function am(){var b=t(aV).data("settings").url;return"function"==typeof t(aV).data("settings").url&&(b=t(aV).data("settings").url.call(t(aV).data("settings"))),b}function al(b){setTimeout(function(){b.focus()},50)}if("string"==typeof aU||"function"==typeof aU){t(aV).data("settings").url=aU;var ak=am();void 0===t(aV).data("settings").crossDomain&&"string"==typeof ak&&(t(aV).data("settings").crossDomain=-1===ak.indexOf("://")?!1:location.href.split(/\/+/g)[1]!==ak.split(/\/+/g)[1])}else{"object"==typeof aU&&(t(aV).data("settings").local_data=aU)}t(aV).data("settings").classes?t(aV).data("settings").classes=t.extend({},p,t(aV).data("settings").classes):t(aV).data("settings").theme?(t(aV).data("settings").classes={},t.each(p,function(h,b){t(aV).data("settings").classes[h]=b+"-"+t(aV).data("settings").theme})):t(aV).data("settings").classes=p;var aj,ai,ah=[],ag=0,af=new t.TokenList.Cache,ae=t('<input type="text" class="input_group_add" autocomplete="off" autocapitalize="off"/>').css({outline:"none"}).attr("id",t(aV).data("settings").idPrefix+aV.id).focus(function(){return t(aV).data("settings").disabled?!1:((null===t(aV).data("settings").tokenLimit||t(aV).data("settings").tokenLimit!==ag)&&aD(),void f.addClass(t(aV).data("settings").classes.focused))}).blur(function(){c?al(ae):aG(),t(aV).data("settings").allowFreeTagging&&aO(),t(this).val(""),f.removeClass(t(aV).data("settings").classes.focused)}).bind("keyup keydown blur update",aP).keydown(function(u){var j,i;switch(u.keyCode){case n.LEFT:case n.RIGHT:case n.UP:case n.DOWN:if(0===this.value.length){j=e.prev(),i=e.next(),j.length&&j.get(0)===ac||i.length&&i.get(0)===ac?u.keyCode===n.LEFT||u.keyCode===n.UP?aK(t(ac),o.BEFORE):aK(t(ac),o.AFTER):u.keyCode!==n.LEFT&&u.keyCode!==n.UP||!j.length?u.keyCode!==n.RIGHT&&u.keyCode!==n.DOWN||!i.length||aL(t(i.get(0))):aL(t(j.get(0)))}else{var b=null;u.keyCode===n.DOWN||u.keyCode===n.RIGHT?(b=t(aw).find("li").first(),g&&(b=t(g).next())):(b=t(aw).find("li").last(),g&&(b=t(g).prev())),aq(b)}break;case n.BACKSPACE:if(j=e.prev(),0===this.value.length){return ac?t(ac).hasClass(t(aV).data("settings").classes.tokenReadOnly)||(aI(t(ac)),ad.change(),(ad.data("submit")&&ad.closest("form").submit())):j.length?aL(t(j.get(0))):(aG(),aD()),!1}1===this.value.length?(aG(),aD()):setTimeout(function(){ao()},5);break;case n.TAB:case n.ENTER:case n.NUMPAD_ENTER:case n.COMMA:if(g){aM(t(g).data("tokeninput")),ad.change(),aD()}else{if(t(aV).data("settings").allowFreeTagging){if(t(aV).data("settings").allowTabOut&&""===t(this).val()){return !0}aO()}else{if(t(this).val(""),t(aV).data("settings").allowTabOut){return !0}}u.stopPropagation(),u.preventDefault()}return !1;case n.ESCAPE:return aG(),!0;default:0===this.value.length&&(aG(),aD()),String.fromCharCode(u.which)&&setTimeout(function(){ao()},5)}});aT.placeholder&&ae.attr("placeholder",aT.placeholder);var ad=t(aV).hide().val("").focus(function(){al(ae)}).blur(function(){return ae.blur(),ad}),ac=null,aa=0,g=null,f=t("<ul />").addClass(t(aV).data("settings").classes.tokenList).click(function(d){var h=t(d.target).closest("li");h&&h.get(0)&&t.data(h.get(0),"tokeninput")?aJ(h):(ac&&aK(t(ac),o.END),al(ae))}).mouseover(function(h){var b=t(h.target).closest("li");b&&ac!==this&&b.addClass(t(aV).data("settings").classes.highlightedToken)}).mouseout(function(h){var b=t(h.target).closest("li");b&&ac!==this&&b.removeClass(t(aV).data("settings").classes.highlightedToken)}).insertBefore(ad),e=t("<li />").addClass(t(aV).data("settings").classes.inputToken).appendTo(f).append(ae),c=!1,a=t("<div/>").addClass(t(aV).data("settings").classes.dropdown).appendTo("body").hide().mousemove(function(){c=!0}).mouseout(function(){c=!1}),az=t("<div id='token-input-dropdown-hint'/>").appendTo(a).hide(),aX=t("<div id='token-input-dropdown-searching'/>").appendTo(a).hide(),aw=t("<div id='token-input-dropdown-result'/>").appendTo(a).hide(),aW=t("<tester/>").insertAfter(ae).css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:ae.css("fontSize"),fontFamily:ae.css("fontFamily"),fontWeight:ae.css("fontWeight"),letterSpacing:ae.css("letterSpacing"),whiteSpace:"nowrap"});ad.val("");var aA=t(aV).data("settings").prePopulate||ad.data("pre");t(aV).data("settings").processPrePopulate&&t.isFunction(t(aV).data("settings").onResult)&&(aA=t(aV).data("settings").onResult.call(ad,aA)),aA&&aA.length&&t.each(aA,function(h,d){aN(d),aQ(),ae.attr("placeholder",null)}),t(aV).data("settings").disabled&&aR(!0),"function"==typeof t(aV).data("settings").onReady&&t(aV).data("settings").onReady.call(),this.clear=function(){f.children("li").each(function(){0===t(this).children("input").length&&aI(t(this))})},this.add=function(b){aM(b)},this.remove=function(d){f.children("li").each(function(){if(0===t(this).children("input").length){var i=t(this).data("tokeninput"),h=!0;for(var b in d){if(d[b]!==i[b]){h=!1;break}}h&&aI(t(this))}})},this.getTokens=function(){return ah},this.toggleDisabled=function(b){aR(b)},this.destroy=function(){this.clear(),a.remove()},aP();var ay=new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g")},t.TokenList.Cache=function(a){var j,i,h={},g=0;j=t.extend({max_size:500},a),i=function(){h={},g=0},this.add=function(d,c){g>j.max_size&&i(),h[d]||(g+=1),h[d]=c},this.get=function(b){return h[b]}}}(jQuery);